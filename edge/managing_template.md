# 创建和管理设备模板

设备模板是设备接入的桥梁，由以下两部分组成。
- 规约
- 设备测点映射关系

对于一个真实设备，其设备测点的名称多数情况下是客户化的，系统无法直接识别此客户化的名称。因此，需要将客户化的实际测点与标准化的设备模型领域点对应起来。另一方面，需配置设备接入的规约。

## 关于此任务<description>

设备模板的创建步骤：

.. image:: media/image035.png
   

设备模板的创建主要有2种方式：

- 全新创建。
- 基于原有设备模板复制创建，而后基于此模板做修改。该方式适用于两种设备模板近似的场景，通过复制的方式获取副本而后稍作修改得到新模板，可减少实施的工作量。

## 全新创建设备模板<createtemplate>

1. 在EnOS控制台导航栏中点击 **设备Edge接入 > 设备模板**。

2. 点击 **新建设备模板**。

3. 在弹出的对话框填写设备基本信息及选择设备模型。

4. 点击 **保存** 创建模板。

5. 点击新建好的模板记录后的 |037| 。

6. 进入模板详情页面，根据下列说明配置设备模板。

设备模板包括基本信息栏、配置栏和模型选择与映射栏。


### 配置基本信息<basicinformation>

在 **基本信息** 部分，填写设备基本信息，选择规约类型和具体规约。

你可以查看和选择当前EnOS Edge支持的通用规约以及各规约关联的模板。点击规约详情链接，在弹出的对话框中，光标置于 |041| 图标处，可查看各规约的描述信息，以确定合适的规约。

.. image:: media/image040.png
   

.. note:: 若没有找到合适规约，可联系平台系统管理员。你也可以重新开发规约并上传到规约管理中心，并进行编辑，更新等操作。有关开发新规约，参考[创建规约](creating_protocol)。

### 上传点表<pointtable>

在 **配置** 部分，你需要编辑两个配置文件：

- `config.sys`文件是与通信规约相关的参数配置文件
- `point.csv`表是设备实际的测点表。

1. 下载配置`config.sys`模板和`point.csv`模板。

2. 根据你的需求修改两个模板。

   .. note:: point.csv点表需为UTF-8 BOM格式，格式不正确可能导致显示出错等问题。

3. 点击 **上传** 上传配置完的`config.sys`和`point.csv`。

   .. note:: 若point.csv表里的"别名"列有值，在进行更新点表操作，即上传一份新的点表时，需首先上传一份空的点表覆盖原有的，再上传实际的点表，以免出错。

如果上一步通信规约选择完成后，这里上传`point.csv`表成功，则会在下方的预览栏中看到`point.csv`表中的测点信息，如下图所示：

.. image:: media/image043.png
   

### 选择模型与配置映射关系<mapping>

在 **模型选择与映射** 部分，你可以通过配置映射关系将客制化的实际点与标准化的设备模型点对应起来。主要步骤为：

1. 在设备模型列表中选择采用的标准设备模型。

2. 找到需配置映射的测点记录，点击标准模型点右侧的 |045|。

3. 在弹出窗口中，选择其所要对应的实际采集点或在搜索栏输入关键字查找到实际采集点，如下图所示：

   .. image:: media/image046.png
      

4. 添加配置映射关系：

   - 对于简单一一对应的映射关系，直接勾选相应的测点即可。
   - 对于复杂的映射关系，可点击 **添加公式** 配置映射公式

     以"SUM"相加公式为例
     + 在公式算法栏中选择"SUM"。
     + 在获取采集点框中，按相加顺序点选采集点的 |049| 完成设置。如下图所示，添加的公式为"ai.4999+ai.5001"，顺序和点击顺序一致：

     .. image:: media/image050.png
        

     .. note:: 添加顺序在某些公式中很重要，如在cross product操作中，公式算法栏选择"cross product"，按顺序选择四个点，添加的公为"(ai.4999\*ai.5000+ai.5009\*ai.5010)"，图中操作数一栏类似于系数，为0则不操作，例如下图中操作数为0.01，则最后添加的公式为"(ai.4999\*ai.5000+ai.5009\*ai.5010)\*0.01"。

     .. image:: media/image051.png
        

### 批量配置映射关系<batchconfiguration>

在 **模型选择与映射** 部分，你可以通过以下步骤实现一次性完成所有映射关系配置：

1. 点击 **导出** 下载领域点映射表。

2. 在领域点映射表中，只需要在mapping列下填写采集点的点号即可，mdesp一列指采集点的描述，不需要填写。

3. 保存表格。

4. 点击 **导入** 上传领域点映射表。

5. 在成功上传映射关系表后，再下载领域点列表，即可下载包含了映射关系的映射关系表，此时的表中已包含了采集点的描述（因描述可以从驱动配置文件point.csv表中自动获取）。

6. 完成映射关系配置后，各标准模型点对应的采集点点号及描述关系可在页面中看到。

7. 点击 **保存** 完成设备模板的编辑操作。

.. note:: - 并非所有设备模型点都需要配置映射关系，具体根据各领域的应用需求而定。
   - 需要添加公式映射的点必须通过手动添加的方式来配置，无法直接使用导入/导操作。
   - 通过配公式映射的点，不会出现在导出后的csv文件中，但是在后台是存在的。

## 通过复制创建设备模板<clonetemplate>

在模板管理菜单页可查看本客户下所有设备模板，当某个新设备的设备模板与已有设备模板类似时，可通过复制创建的方式，减少实施工作量。

1. 在模板列表中找到目标设备列表，点击 **复制**。

2. 在弹出窗口中，为新模板设置一个唯一的名称。

3. 点击 **保存** 完成创建。

4. 点击新创建好的模板后的 |045| ，根据你的需求修改模板的信息。

## 修改和删除设备模板<editdelete>

在 **模板管理** 页中：

- 修改模板：点击待修改模板后的 |045| ，进入目标设备模板详情页面即可修改模板。
- 删除模板：待机待删除模板后 |delete| 即删除模板。

.. warning:: 对已经被使用的模板的修改和删除操作需要谨慎，因为将会影响到所有使用到该模板的设备实例。

.. |041| image:: media/image041.png

.. |045| image:: media/image045.png

.. |037| image:: media/image037.png

.. |049| image:: media/image049.png

.. |delete| image:: media/delete_icon.png

<!--end-->
