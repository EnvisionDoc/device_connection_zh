# 创建模型

模型是对产品功能的抽象，模型定义了产品是什么、能做什么、可以对外提供哪些服务。该文章描述了如何创建模型。

## 开始前准备<beforestart>

- 已设计好该模型所需要的功能。有关如何进行模型的功能设计，参见 [物模型概述](model_overview)。
- 你需要有设备管理操作权限，如果没有需联系组织管理员添加。有关EnOS内的用户权限，参见 [策略，角色，与权限](/docs/iam/zh_CN/latest/access_policy)。

## 任务描述<description>

根据定义好的物模型，在EnOS中配置各项功能。
- 属性
- 测点
- 服务
- 事件

## 步骤一：创建模型<createmodel>

1. 在EnOS控制台中选择 **模型及资产 > 模型管理**。

2. 点击页面右上方 **创建模型**，在 **创建模型** 页面配置下列信息：

   - **模型标识符**：模型的唯一识别码。
   - **模型名称**：模型的默认名称，必填项，在同一组织下不可重复；
   - **分类**：产品的静态扩展信息。如厂商、设备型号等。
   - **模型关系**：
     - 无：暂不配置具体属性。在模板创建完毕后手动定义要素。
     - 拷贝：复制源模型上的所有信息。通过拷贝创建的模型与其源模型无关联。
     - 继承：复制源模型上的所有信息。与源模型关联。    
       - 子模型继承父模型的所有元素，子模板不可修改父模板中的元素。
       - 子模型可以在父模型基础上增加新的元素，但不可以与父模型重名。
       - 子模型可以再被继承，支持多层的继承关系。
       - 父模型中元素的改动会关联到子模版中。
   - **模型模板**：选择拷贝的模板或者继承的父模板。
   - **模型描述**：对模型的详细描述。

3. 点击 **确定** 完成操作。

## 步骤二：为模型定义要素<defineelements>

1. 点击需要定义功能的模型的所对应的 **修改**。

2. 选择 **功能定义** 标签，并点击 **新增**，根据产品属性设置一个或多个功能要素。

### 新增属性<attributes>

1. 在 **添加功能** 页面，**功能类型** 中选择 **属性**，并配置如下信息：

   - **名称**：属性的名称，同一模块下的名称不可重复。
   - **标识符**：功能的唯一标识码，同一组织下不可重复。此值为JSON格式中的identifier的值，作为设备上报该属性数据的Key，云端根据该标识符校验是否接收数据。
   - **数据类型**：该属性的数据类型。

     + int,float,double：需定义默认值，该数据的单位等信息。
     + enum：需定义枚举项的参数值和该参数的描述。

       .. csv-table::
          :widths: auto

          "字段", "描述"
          "参数值", "支持int和string类型，长度不超过32个字符。只有当所有参数值都是int类型时，参数值才会作为int类型保存；在参数值中存在一个或多个string类型字符，则全体参数值作为string类型保存。"
          "参数描述", "支持中文、英文大小写、数字和特殊字符“-”、“_”、“@”、“.”、和“:”，长度不超过128个字符"
       
       .. note:: 参数值以int类型还是string类型存储，以创建时的设置为准。如创建该enum类型参数时，参数都以int类型保存，后续如果在某个enum参数值中加入字符时，EnOS会提示参数类型错误，因为所有参数值都已被设置为int类型；如过创建该类型时，参数都保存为string类型，则后续如果修改参数值列表，使其不包含任何字符，这些变量依然会保存为string类型，而不是int，此时EnOS不会提示参数类型错误。

     + bool：需采用0和1来定义布尔值。
     + string：需定义string的数据长度。
     + timestamp：timestamp的格式为String类型的UTC时间戳(毫秒)。
     + date：date的格式为yyyy-MM-dd HH:mm:ss。
     + struct：通过定义 **参数名**，**标识符**，**数据类型** 和 **单位** 来定义一个JSON结构体。
     + array：需定义 **元素类型**。确保同一个数组元素类型相同。
     <!--+ map：映射参数，map为JSON格式的字符段。-->
     + file：文件类型参数，value值为URI格式的文件路径。如果用在测点类型当中，通过open Api的方式上传文件，系统会自动将文件路径保存到value当中。

   - **是否必填**：如果设置为必填，新建在该产品下的设备时，必须填写该参数。
   - **描述**：对属性的描述。

2. 点击 **确定** 完成创建该属性。

3. 重复以上操作创建更多属性。

### 新增测点<measurepoints>

测点页面中的配置信息如下：

1. 在 **添加功能** 页面，**功能类型** 中选择 **测点**，并配置如下信息：

   - **名称**：必填项。 测点的名称，同一模块下的名称不可重复。

   - **标识符**：必填项。测点唯一标识码，同一组织下不可重复。此值为JSON格式中的identifier的值，作为设备上报该属性数据的Key，云端根据该标识符校验是否接收数据。

   - **测点类型**：必填项。测点类型用于区别测点数据的不同特征。在存储数据时，不同类型的测点数据可分类存储；在读取数据时，对不同类型的数据提供不同的处理能力。对各测点类型的描述如下：

     - AI：AI类型的测点数据一般为数值型数据，在读取数据时可对数据进行聚合处理
     - DI：DI类型的测点数据一般为设备状态数据，在读取数据时可对数据进行变位查询
     - PI：PI类型的测点数据一般为电量计算数据，在读取数据时可进行聚合处理
     - 通用：除以上类型以外的其他类型的测点，一般用于上传非数值类型的数据

     .. note:: 如果已有测点数据存储到TSDB，测点类型不能修改。测点类型的变更会导致已存储的历史数据无法查询。更多详细信息，参见 [配置TSDB存储](/docs/data-asset/zh_CN/latest/configuring_tsdb_storage.html)。

   - **是否有质量位**：设置该测点值是否代表数据质量。如果设置为 **有**，则配置如下：

     + 质量位：系统使用预定义的数组型的数据质量指示，不可更改。可点击 **查看** 了解预定义的质量位参数和描述。
     + 值：设置该测点的数据类型。类型只支持int,float和double。

   - **数据类型**：必填项。如果该测试不是质量指数，则配置该测点的数据类型。
     + int,float,double：需定义默认值，该数据的单位等信息。
     + enum：需定义枚举项的参数值和该参数的描述。
     + bool：需采用0和1来定义布尔值。
     + string：需定义默认值，String的类型和string的数据长度。
     + timestamp：timestamp的格式为String类型的UTC时间戳(毫秒)。
     + date: date的格式为yyyy-MM-dd HH:mm:ss。
     + struct：通过定义 **参数名**，**标识符**，**数据类型** 和 **单位** 来定义一个JSON结构体。
     + array：需定义 **元素类型**。确保同一个数组元素类型相同。
     + file：文件类型参数，value值为URI格式的文件路径。如果用在测点类型当中，通过open Api的方式上传文件，系统会自动将文件路径保存到value当中。

   - **单位**：选择测点数据的单位。

   - **自定义标签**：测点的标签是对测点本身进行描述，可根据需要对测点进行灵活的标识，如测点的类型、分组、优先级等。

   - **描述**：对该测点的描述。

2. 点击 **确认** 来创建该测点。

3. 重复以上操作创建更多测点。

   .. note:: 在创建新测点之后，需要及时为测点数据配置存储策略。否则设备接入到云端后，测点数据不会默认被存储到时序数据库。有关配置存储策略的详细步骤，参见 [配置TSDB存储](/docs/data-asset/zh_CN/latest/configuring_tsdb_storage.html)。

### 新增服务<services>

1. 在 **添加功能** 页面，**功能类型** 中选择 **服务**，并配置如下信息：

   - **名称**：服务的名称，同一模块下的名称不可重复。
   - **标识符**：服务唯一标识码，同一组织下不可重复。此值为JSON格式中的identifier的值，作为设备上报该属性数据的Key，云端根据该标识符校验是否接收数据。
   - **调用方式**：服务的调用方式。
     + 同步：云端执行调用服务后，会等待设备回复，如无回应，则调用超时。
     + 异步：云端执行调用后直接返回，由异步的方式获取设备的回复消息。
   - **输入参数**：点击 **新增参数** 配置该服务的输入参数的参数名，识别符，数据类型和数据单位。
   - **输出参数**：点击 **新增参数** 配置该服务的输出参数的参数名，识别符，数据类型和数据单位。
   - **描述**：对该服务的描述。

2. 点击 **确认** 来创建该服务。

3. 重复以上操作创建更多服务。

### 新增事件

1. 在 **添加功能** 弹窗，**功能类型** 选择 **事件**，并填写以下字段：

 - **名称** ：事件的名称。同一个模型下事件名称不能重复。
 - **标识符**：事件的唯一标识。同一OU下不得重复。该标识符在JSON格式下用于设备发送属性数据的键值对。云端会验证标识符，然后再判断是否接收数据。
 - **事件类型**：
     + 信息：指设备发出的通知，比如任务完成的通知。
     + 告警：告警信息。运行中的设备自发上报的紧急情况或者异常情况。这些事件优先级较高。你可以根据告警级别采取处理措施或进行进一步数据分析。
     + 故障：故障信息。运行中的设备自发上报的紧急情况或异常情况。优先级最高。应当根据故障级别采取处置措施或者进行进一步数据分析。
 - **输出参数**：点击 **新增参数** 以配置输出参数的名称、标识符、数据类型、数据单位。
 - **描述**：事件的描述。

2. 点击 **确认** ， 完成事件的创建。


## 步骤3：（可选）添加标签<addtags>

标签描述同类模型所具有的共性信息。用于区分模型对象所属的领域、类型、范围等各种分类。比如，你可以通过添加 **domain:solar** 标签代表该模型属于太阳能领域。

1. 从设备列表中找到目标设备并点击设备后 **查看**。

2. 在 **基础信息** 标签下的 **标签** 区域中点击 **编辑**。

3. 在弹出窗口中，点击 **创建标签**，输入新标签的键值对（key:value）。

4. 点击 **OK** 来保存标签。

## 结果<result>

完成模型功能定义后，系统将自动生成该产品的模型，以JSON格式表述。

## 相关信息<relatedinformation>

- [模型概述](model_overview)
- [创建产品](../device/manage/creating_product)
