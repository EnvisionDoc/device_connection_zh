# 批量注册设备

使用批量导入设备功能，可以创建大量同类设备。

## 任务描述

当用户有大量同类设备需要创建时，可选择以下方式批量上传设备:
- 可以下载空白模板，填入设备信息并上传以批量创建设备；
- 利用已创建设备的信息生成模板，再将设备信息填入模板并上传，完成批量导入。

## 开始前准备

- 该设备所属的产品已经被创建。有关如何创建，参见[创建产品](creating_product)。
- 你需要有设备管理操作权限，如果没有请联系组织管理员添加，参见[策略，角色，与权限](/docs/iam/zh_CN/2.0.9/access_policy)。

## 操作步骤

1. 选择 **设备管理 > 设备管理**。
   
2. 选择**批量添加**，选择批量添加的设备所属产品。

3. 从以下方式中择一，下载模板：

  - **下载空白模板**，然后点击**空白模板**下载；
  - 如果想导入的设备与设备列表上已创建的产品类型具有同类属性，选择**生成基础模板**，在下拉列表中根据device key选择一个设备，点击**生成模板**下载。
   
  .. note:: 下载的模板文件名为“Template_*product_key*.xlsx”，*product_key*是设备所属产品的product key，可以在**设备管理 > 产品管理**中查看。

  .. image:: ../../../media/device_batch_import.png

4. 在模板中按格式要求填入设备相关信息，模板包含以下固定字段：

  .. csv-table::
     :widths: auto

     "字段", "说明"
     "DeviceKey", "设备的Device key，推荐使用SN、IMEI或者MAC地址作为Device key。支持大小写字母、数字和连字符（-）、下划线（_）、英文句号（.）、英文冒号（:）。长度为4到64个字符。需保证DeviceKey在OU下唯一。"
     "设备名称", "用于在控制台设备列表中搜索设备，中文、大小写字母、数字和连字符（ - ）、下划线（ _ )、英文句号（.）和英文冒号（:），长度不超过64个字符。"
     "设备时区", "设备所在时区。如果该地区使用夏令时，应在下拉列表中选择夏令时适用的城市。"

  模板中的其他字段为该设备的属性，属性的名称、支持的数据类型、是否必填项都继承自设备所属产品的模型。

  由已有设备生成的模板中，包含了与空白模板相同的基础字段，在该模板文件（.xlsx）的第三行，还记录了该已有设备的属性信息。在填入新设备信息之前，应将已有设备信息删除。由已有设备生成的模板示例如下：

  .. image:: ../../../media/batch_import_device_sample_template.png

5. 点击**上传文件**，浏览并选择已填好的模板，确认并上传文件。上传的模板必须为符合下列要求：
  - 文件格式必须是.xlsx。
  - 文件大小不超过2M。
  - 包含的设备记录不超过1000条。如需上传超过1000条设备记录，可以将设备记录分多个模板文件上传。
  - 单个产品下的设备不超过10个，设备列表已有设备数量加上模板中的设备记录数不超过10万个。否则EnOS会提示到达上限，无法继续添加。

6. 点击**确定**，EnOS开始解析文件。

## 结果

查看导入结果：
- 如果模板中包含了无效记录，可以选择**导出无效记录**，浏览器将下载一个名为“errmsg.txt”的文本文档。其内容为“Line *n*: *error_message*”。n代表无效记录所在行数，*error_message*为无效的原因。常见原因如下：

 - 字段格式不合法、长度超过限制；
 - 必填项没有数据；
 - DeviceKey不唯一；


- 如果模板中包含了有效记录，可以点击**确定**，将有效记录导入EnOS。完成导入后，可在设备列表中查看批量导入的设备。

## 后续操作


为使设备上传的数据能存储在TSDB，以便后续数据分析，你需要在激活设备之前配置TSDB存储。否则设备的上传的数据默认不会被存储到TSDB中。更多信息，参见[配置TSDB存储](/docs/data-asset/zh_CN/2.0.9/configuring_tsdb_storage)。

新创建的设备在未上线的情况显示为未激活。如需激活设备，你需要通过设备端SDK发起连接。更多信息，参考[EnOS SDK 快速入门](/docs/app-development/zh_CN/2.0.9/gettingstarted_sdk.html)


## 相关信息

- [创建模型](../../model/creating_model)
- [创建产品](creating_product)
- [创建设备](creating_device)