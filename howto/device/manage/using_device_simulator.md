# 使用设备模拟器

用户可以使用EnOS提供的设备模拟器功能用于以下场景：

- EnOS入门学习工具：用户可以通过该功能模拟设备接收数据，以熟悉EnOS各项功能。
- 异常调试：应用开发过程中，有时候需要模拟设备发送特殊值的数据以验证设备的处理逻辑。现实中设备上报这种特殊值的可能性很小、或者时机不确定，则可以通过模拟器快速便捷地模拟出来，为应用开发和测试提供便利。

## 任务描述

用户可以通过设备模拟器管理功能创建并管理设备模拟器。

## 开始前准备

- 需要模拟的设备实例已经被注册。参见[注册设备](creating_device)。

- 你需要有设备管理相关权限，如果没有请联系组织管理员添加，参见[策略，角色，与权限](/docs/iam/zh_CN/latest/access_policy)。


## 步骤1：添加设备模拟器

1. 在EnOS控制台中选择 **设备管理 > 设备模拟器** 。

2. 点击 **添加模拟设备** ，在页面上勾选需要模拟的设备。
   
   设备列表上列举了当前OU已创建的所有设备，用户只能选择状态为“未激活”的设备进行模拟。状态为“在线”或者“离线”的设备无法被模拟。

3. 点击 **确定** 来创建该设备的模拟器。
   
   在模拟器列表上，可以看到刚才创建成功的模拟器。接下来需要为其定义模拟数据样本。

## 步骤2：定义模拟数据样本

如果设备数量较少，可以逐个添加样本。如果导入了大量同类的设备、即设备所属产品相同，可以批量添加模拟器数据样本。

### 逐个添加样本

1. 从设备模拟器列表中找到刚才创建的模拟器，点击操作栏的 |edit| 。

 .. |edit| image:: ../../../media/button_edit.png

2. 在弹出窗口中，点击 **下载数据模板** 。

3. 在下载的模板中填入模拟数据样本并保存。

 第一列表头**timeOfDay**表示相对时间戳：第一列是一天24小时内的相对时间戳，格式为H:MM:SS，精确到秒。

 第二列表头开始为模型测点标识符，填入需要模拟的测点标识符即可，不需要列出模型中的所有点。内容为测点值。若为数组类型，则采用[value1, value2, value3]的形式，如果在当前时间某个点没有值，则留空不填。

4. 在弹出窗口中，点击 **上传数据**，将准备好的模拟数据上传。

5. 点击 **确认** 完成。

### 批量添加样本

1. 点击 **批量定义样本** 。

2. 选择需要批量添加数据样本的产品。

3. 点击 **下载数据模板** 。

4. 编辑下载好的 *sample.xlsx* 数据样本文件并保存。

  你可以输入一些特殊值以模拟异常。

5. 点击 **上传数据** ， 选择编辑好的样本上传，点击 **下一步** 。

6. 选择需要模拟的设备，点击 **确认** 。

 如果选中的设备已经有定义的样本，则原样本会被覆盖。

## 步骤3：启动设备模拟器

你可以逐个启动设备模拟器。如果需要启动的模拟器数量较多，也可以批量启动多个模拟器。

### 逐个启动模拟器

1. 从设备模拟器列表中找到目标模拟器并点击设备后 **启动**；

2. 在弹出的窗口中设置模拟结束时间。

   模拟开始时间默认为点击**启动**时的系统时间，模拟器的结束时间最晚不超过当前系统时间之后90天。

### 批量启动模拟器

1. 在设备模拟器列表中，勾选需要批量启动的模拟器。

  只能选择已经定义好数据样本的模拟器。

2. 点击 **更多 > 批量开启**。

3. 为选中批次的模拟器设置统一的模拟器结束时间。

 模拟器的结束时间最晚不超过当前系统时间之后90天。

 如果选中的模拟器中，包含已经开始模拟的模拟器，则其结束时间会被修改为新设置的时间。

## 结果

设备模拟器开始模拟数据上报，用户可以根据需要暂停设备模拟器、下载数据样本、或者重新定义数据样本。用户需要先暂停模拟器方可重新定义或下载数据样本。


